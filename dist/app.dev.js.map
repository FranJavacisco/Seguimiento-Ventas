{"version":3,"sources":["app.js"],"names":["db","salesData","initDB","request","indexedDB","open","onerror","event","console","error","onsuccess","target","result","loadSalesData","onupgradeneeded","createObjectStore","keyPath","autoIncrement","transaction","objectStore","getAll","formatNumber","input","value","replace","Intl","NumberFormat","format","discountIVA","amount","saveSale","saleAmount","parseFloat","document","getElementById","warrantyAmount","insuranceAmount","productDescription","date","Date","dateString","toLocaleDateString","toLocaleTimeString","saleRecord","add","push","updateIndicators","clearFields","alert","record","textContent","toFixed","toLocaleString","downloadReport","reportData","map","Fecha","Descripción","worksheet","XLSX","utils","json_to_sheet","workbook","book_new","book_append_sheet","writeFile","guardarVenta","montoVenta","montoGarantia","montoSeguro","descripcion","fecha","collection","firebase","firestore","Timestamp","fromDate","log","obtenerVentas","orderBy","get","snapshot","forEach","doc","venta","data"],"mappings":"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","sourcesContent":["let db;\r\nlet salesData = [];\r\n\r\n// Iniciar IndexedDB\r\nfunction initDB() {\r\n    let request = indexedDB.open(\"SalesDB\", 1);\r\n\r\n    request.onerror = (event) => {\r\n        console.error(\"Error al abrir la base de datos\", event);\r\n    };\r\n\r\n    request.onsuccess = (event) => {\r\n        db = event.target.result;\r\n        loadSalesData();\r\n    };\r\n\r\n    request.onupgradeneeded = (event) => {\r\n        db = event.target.result;\r\n        db.createObjectStore(\"sales\", { keyPath: \"id\", autoIncrement: true });\r\n    };\r\n}\r\n\r\nfunction loadSalesData() {\r\n    const transaction = db.transaction([\"sales\"], \"readonly\");\r\n    const objectStore = transaction.objectStore(\"sales\");\r\n\r\n    objectStore.getAll().onsuccess = (event) => {\r\n        salesData = event.target.result || [];\r\n    };\r\n}\r\n\r\nfunction formatNumber(input) {\r\n    let value = input.value.replace(/\\D/g, '');\r\n    input.value = new Intl.NumberFormat('es-ES').format(value);\r\n}\r\n\r\nfunction discountIVA(amount) {\r\n    return amount / 1.19;\r\n}\r\n\r\nfunction saveSale() {\r\n    const saleAmount = parseFloat(document.getElementById(\"saleAmount\").value.replace(/\\./g, '')) || 0;\r\n    const warrantyAmount = parseFloat(document.getElementById(\"warrantyAmount\").value.replace(/\\./g, '')) || 0;\r\n    const insuranceAmount = parseFloat(document.getElementById(\"insuranceAmount\").value.replace(/\\./g, '')) || 0;\r\n    const productDescription = document.getElementById(\"productDescription\").value || \"Sin descripción\";\r\n\r\n    const date = new Date();\r\n    const dateString = `${date.toLocaleDateString()} ${date.toLocaleTimeString()}`;\r\n\r\n    const saleRecord = {\r\n        saleAmount,\r\n        warrantyAmount,\r\n        insuranceAmount,\r\n        productDescription,\r\n        dateString\r\n    };\r\n\r\n    const transaction = db.transaction([\"sales\"], \"readwrite\");\r\n    transaction.objectStore(\"sales\").add(saleRecord).onsuccess = () => {\r\n        salesData.push(saleRecord);\r\n        updateIndicators(saleRecord);\r\n        clearFields();\r\n        alert(\"Venta guardada correctamente\");\r\n    };\r\n}\r\n\r\nfunction updateIndicators(record) {\r\n    document.getElementById(\"ventaSinIVA\").textContent = discountIVA(record.saleAmount).toFixed(2).toLocaleString('es-ES');\r\n    document.getElementById(\"garantiaSinIVA\").textContent = discountIVA(record.warrantyAmount).toFixed(2).toLocaleString('es-ES');\r\n    document.getElementById(\"seguroSinIVA\").textContent = discountIVA(record.insuranceAmount).toFixed(2).toLocaleString('es-ES');\r\n    document.getElementById(\"crucePercent\").textContent = ((record.warrantyAmount + record.insuranceAmount) / record.saleAmount * 100).toFixed(2) + \"%\";\r\n}\r\n\r\nfunction clearFields() {\r\n    document.getElementById(\"saleAmount\").value = '';\r\n    document.getElementById(\"warrantyAmount\").value = '';\r\n    document.getElementById(\"insuranceAmount\").value = '';\r\n    document.getElementById(\"productDescription\").value = '';\r\n}\r\n\r\nfunction downloadReport() {\r\n    const transaction = db.transaction([\"sales\"], \"readonly\");\r\n    const objectStore = transaction.objectStore(\"sales\");\r\n\r\n    objectStore.getAll().onsuccess = (event) => {\r\n        const reportData = event.target.result.map((record) => {\r\n            return {\r\n                Fecha: record.dateString,\r\n                Descripción: record.productDescription,\r\n                \"Monto de Venta\": record.saleAmount.toLocaleString('es-ES'),\r\n                \"Monto de Garantía\": record.warrantyAmount.toLocaleString('es-ES'),\r\n                \"Monto de Seguro\": record.insuranceAmount.toLocaleString('es-ES'),\r\n                \"Monto de Venta Neto (sin IVA)\": discountIVA(record.saleAmount).toFixed(2).toLocaleString('es-ES'),\r\n                \"Monto de Garantía Neto (sin IVA)\": discountIVA(record.warrantyAmount).toFixed(2).toLocaleString('es-ES'),\r\n                \"Monto de Seguro Neto (sin IVA)\": discountIVA(record.insuranceAmount).toFixed(2).toLocaleString('es-ES'),\r\n                \"% Cruce\": ((record.warrantyAmount + record.insuranceAmount) / record.saleAmount * 100).toFixed(2) + \"%\"\r\n            };\r\n        });\r\n\r\n        const worksheet = XLSX.utils.json_to_sheet(reportData);\r\n        const workbook = XLSX.utils.book_new();\r\n        XLSX.utils.book_append_sheet(workbook, worksheet, \"Reporte de Ventas\");\r\n\r\n        XLSX.writeFile(workbook, \"reporte_ventas.xlsx\");\r\n    };\r\n}\r\n\r\ninitDB();\r\n\r\nasync function guardarVenta(montoVenta, montoGarantia, montoSeguro, descripcion) {\r\n    try {\r\n      const fecha = new Date();\r\n      await db.collection(\"ventas\").add({\r\n        montoVenta,\r\n        montoGarantia,\r\n        montoSeguro,\r\n        descripcion,\r\n        fecha: firebase.firestore.Timestamp.fromDate(fecha),\r\n      });\r\n      console.log(\"Venta guardada exitosamente\");\r\n    } catch (error) {\r\n      console.error(\"Error al guardar la venta: \", error);\r\n    }\r\n  }\r\n\r\n  async function obtenerVentas() {\r\n    try {\r\n      const snapshot = await db.collection(\"ventas\").orderBy(\"fecha\", \"desc\").get();\r\n      snapshot.forEach((doc) => {\r\n        const venta = doc.data();\r\n        console.log(\"Venta registrada:\", venta);\r\n        // Lógica para mostrar cada venta en el reporte\r\n      });\r\n    } catch (error) {\r\n      console.error(\"Error al obtener las ventas: \", error);\r\n    }\r\n  }\r\n  \r\n\r\n\r\n\r\n"],"file":"app.dev.js"}